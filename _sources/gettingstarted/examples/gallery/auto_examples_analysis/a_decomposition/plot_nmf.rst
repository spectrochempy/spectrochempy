
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/plot_nmf.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py:


NMF analysis example
====================

.. GENERATED FROM PYTHON SOURCE LINES 15-16

Import the spectrochempy API package

.. GENERATED FROM PYTHON SOURCE LINES 16-18

.. code-block:: Python

    import spectrochempy as scp








.. GENERATED FROM PYTHON SOURCE LINES 19-21

Prepare the dataset to NMF factorize
-------------------------------------

.. GENERATED FROM PYTHON SOURCE LINES 23-25

Here we use a FTIR dataset corresponding the dehydration of a NH4Y zeolite
and recorded in the OMNIC format.

.. GENERATED FROM PYTHON SOURCE LINES 25-27

.. code-block:: Python

    dataset = scp.read_omnic("irdata/nh4y-activation.spg")








.. GENERATED FROM PYTHON SOURCE LINES 28-31

Mask some columns (features) wich correspond to saturated part of the spectra.
Note taht we use float number for defining the limits for masking as coordinates
(integer numbers would mean point index and s would lead t incorrect results)

.. GENERATED FROM PYTHON SOURCE LINES 31-33

.. code-block:: Python

    dataset[:, 882.0:1280.0] = scp.MASKED








.. GENERATED FROM PYTHON SOURCE LINES 34-37

Make sure all data are positive. For this we use the math fonctionalities of NDDataset
objects (:meth:`min` function to find the minimum value of the dataset
and the `-` operator for subtrating this value to all spectra of the dataset.

.. GENERATED FROM PYTHON SOURCE LINES 37-39

.. code-block:: Python

    dataset -= dataset.min()








.. GENERATED FROM PYTHON SOURCE LINES 40-41

Plot it for a visual check

.. GENERATED FROM PYTHON SOURCE LINES 41-42

.. code-block:: Python

    dataset.plot()



.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_001.png
   :alt: plot nmf
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_001.png
   :class: sphx-glr-single-img



.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">

    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 43-48

Create a NMF object
-------------------

As argument of the object constructor we define log_level to ``"INFO"`` to
obtain verbose output during fit, and we set the number of component to use at 4.

.. GENERATED FROM PYTHON SOURCE LINES 48-50

.. code-block:: Python

    model = scp.NMF(n_components=4, log_level="INFO")








.. GENERATED FROM PYTHON SOURCE LINES 51-53

Fit the model
-------------

.. GENERATED FROM PYTHON SOURCE LINES 53-63

.. code-block:: Python

    model.fit(dataset)
    # Get the results
    # ---------------
    #
    # The concentration :math:`C` and the transposed matrix of spectra :math:`S^T` can
    # be obtained as follow
    C = model.transform()
    St = model.components






.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    violation: 1.0
    violation: 0.14017421024501908
    violation: 0.06158195065493225
    violation: 0.03477774452872477
    violation: 0.023155912689776497
    violation: 0.016289564836607266
    violation: 0.011732197722809774
    violation: 0.009261179153190056
    violation: 0.007770502529914264
    violation: 0.006957471610159052
    violation: 0.00645741437035487
    violation: 0.00619111512528216
    violation: 0.006057238974457651
    violation: 0.006000777806339463
    violation: 0.00586835789130885
    violation: 0.005802918028533867
    violation: 0.005772367658829799
    violation: 0.00575694797177781
    violation: 0.00573333288991883
    violation: 0.005700606624644853
    violation: 0.005667827078790955
    violation: 0.005587736630048203
    violation: 0.0055291351831671404
    violation: 0.005460760674075964
    violation: 0.0053751946734517005
    violation: 0.005288054442075239
    violation: 0.005203284939611636
    violation: 0.005110269931845213
    violation: 0.005004969613317549
    violation: 0.00488940194456708
    violation: 0.004778610916794783
    violation: 0.004657040705272622
    violation: 0.004527642308383362
    violation: 0.004393717477174903
    violation: 0.004267124138925875
    violation: 0.004133928133016165
    violation: 0.004012755928138872
    violation: 0.003891465351926926
    violation: 0.003765260270042852
    violation: 0.003637514821862865
    violation: 0.003514710166154323
    violation: 0.003396513830358619
    violation: 0.0032925205579806033
    violation: 0.003194164813272421
    violation: 0.0031049470293334383
    violation: 0.0030221674035499605
    violation: 0.002938964639033634
    violation: 0.002856115850045667
    violation: 0.0027738912186801275
    violation: 0.0026927116687365813
    violation: 0.002612954828907931
    violation: 0.0025351644702120107
    violation: 0.0024587403634381646
    violation: 0.0023842026907911896
    violation: 0.002313303909478521
    violation: 0.0022437367434811196
    violation: 0.0021751169925787717
    violation: 0.0021084094490923296
    violation: 0.0020436678052479338
    violation: 0.0019806643593508057
    violation: 0.0019243270194358273
    violation: 0.0018713261632058293
    violation: 0.0018195678200695
    violation: 0.0017692749012864504
    violation: 0.001720465749119576
    violation: 0.0016731692686996432
    violation: 0.0016274950351468972
    violation: 0.0015839173329700125
    violation: 0.0015418960309272964
    violation: 0.0015014385431313696
    violation: 0.0014629272012161804
    violation: 0.001426208132161926
    violation: 0.0013907597658087637
    violation: 0.0013601582805157976
    violation: 0.0013328464824003776
    violation: 0.0013065923988234182
    violation: 0.0012813357494809341
    violation: 0.0012569657401120002
    violation: 0.0012363658727399466
    violation: 0.0012190114699549709
    violation: 0.001199211654450095
    violation: 0.001177562262451193
    violation: 0.001158260908541917
    violation: 0.001138941592363113
    violation: 0.0011199124929359703
    violation: 0.001100675488453889
    violation: 0.0010832777040274356
    violation: 0.0010661363692304928
    violation: 0.0010491933694701092
    violation: 0.0010318244102607845
    violation: 0.0010150792321235805
    violation: 0.0009988201809301045
    violation: 0.000984131852881568
    violation: 0.0009699922960877002
    violation: 0.0009545966012010493
    violation: 0.0009396363331385312
    violation: 0.0009266599168144969
    violation: 0.0009140262172599896
    violation: 0.0009015875006379223
    violation: 0.0008902182357106165
    violation: 0.0008780499311868573
    violation: 0.0008660457470919501
    violation: 0.0008543517499938458
    violation: 0.0008428706003288728
    violation: 0.0008315536804369494
    violation: 0.0008208847158800865
    violation: 0.0008104269807766392
    violation: 0.0007997522484734888
    violation: 0.0007893350738955271
    violation: 0.0007791326607914492
    violation: 0.0007691414390016255
    violation: 0.0007597179067853684
    violation: 0.0007504652538891355
    violation: 0.0007412456856969617
    violation: 0.0007322966170539606
    violation: 0.0007235915691682472
    violation: 0.0007151920055395751
    violation: 0.0007069372346703997
    violation: 0.0006987637535247508
    violation: 0.0006907733550826307
    violation: 0.0006830298779800047
    violation: 0.0006754181243923871
    violation: 0.000667979593649365
    violation: 0.00066068933982326
    violation: 0.0006536091296354512
    violation: 0.0006466641120995943
    violation: 0.0006399762615476291
    violation: 0.0006335488650771734
    violation: 0.0006273957420690208
    violation: 0.0006215236000710895
    violation: 0.0006161518203756036
    violation: 0.0006113918151773636
    violation: 0.0006071251736135911
    violation: 0.0006030938520874701
    violation: 0.00059922557718879
    violation: 0.0005955122189368678
    violation: 0.0005919356405961689
    violation: 0.0005884735105287388
    violation: 0.0005851626197894091
    violation: 0.0005819472966804562
    violation: 0.000578862424248167
    violation: 0.0005759087479597466
    violation: 0.0005730546137309673
    violation: 0.0005702968600987651
    violation: 0.0005676053787180693
    violation: 0.0005650176785169122
    violation: 0.0005624480584369479
    violation: 0.0005599281471045574
    violation: 0.0005574208102720947
    violation: 0.0005549930907511983
    violation: 0.0005526263090690988
    violation: 0.0005503237863510385
    violation: 0.0005480875748007384
    violation: 0.0005458976082895087
    violation: 0.000543757085396618
    violation: 0.0005416726314727292
    violation: 0.000539632958222231
    violation: 0.0005376381718608268
    violation: 0.0005358628850808076
    violation: 0.0005342566446343764
    violation: 0.0005327134944358956
    violation: 0.000531170025618257
    violation: 0.0005296374901749773
    violation: 0.0005281469649348079
    violation: 0.0005266549474160065
    violation: 0.0005251860718893862
    violation: 0.0005237318107589514
    violation: 0.0005222955570665936
    violation: 0.000520894296423637
    violation: 0.0005195265168843346
    violation: 0.0005181813428115367
    violation: 0.0005168846752739242
    violation: 0.0005156608680268803
    violation: 0.0005144616554310085
    violation: 0.0005132891688188133
    violation: 0.0005121515266401135
    violation: 0.0005110364330891476
    violation: 0.0005099447315068607
    violation: 0.000508875361379454
    violation: 0.0005078236610580823
    violation: 0.0005067909112021827
    violation: 0.0005057740763560518
    violation: 0.0005047767175615971
    violation: 0.0005037958933648966
    violation: 0.0005028222129273874
    violation: 0.0005018650428478677
    violation: 0.000500922442379878
    violation: 0.0004999974962489648
    violation: 0.0004990872395201279
    violation: 0.000498196200074714
    violation: 0.000497314731819157
    violation: 0.0004964417296739241
    violation: 0.0004955753197883311
    violation: 0.0004946901218458186
    violation: 0.0004938210437307152
    violation: 0.0004929673596844803
    violation: 0.0004921226355845433
    violation: 0.0004912871202794251
    violation: 0.0004904596528539105
    violation: 0.0004896376456530159
    /home/runner/work/spectrochempy/spectrochempy/.venv/lib/python3.13/site-packages/sklearn/decomposition/_nmf.py:1720: ConvergenceWarning: Maximum number of iterations 200 reached. Increase it to improve convergence.
      warnings.warn(
    violation: 1.0
    violation: 0.27811881011284695
    violation: 0.2110383927344168
    violation: 0.16365897573754756
    violation: 0.12638124502857168
    violation: 0.09689398092857943
    violation: 0.07386553913526449
    violation: 0.05726304883639188
    violation: 0.04639710696895154
    violation: 0.03776270101072505
    violation: 0.030324671559649238
    violation: 0.024000077998570575
    violation: 0.0187050543188564
    violation: 0.014282427091628955
    violation: 0.010676123451469408
    violation: 0.008016534827386358
    violation: 0.006238616114828727
    violation: 0.0051243946330302124
    violation: 0.004490757479656458
    violation: 0.004053115751123199
    violation: 0.0037443026036686174
    violation: 0.003428962811660632
    violation: 0.0030323190347558092
    violation: 0.0027272537391466694
    violation: 0.0023865056940469928
    violation: 0.0020851628627840224
    violation: 0.0017697484695162083
    violation: 0.0014925716272857642
    violation: 0.0012488601974045188
    violation: 0.0010438675111377718
    violation: 0.0008573236692762147
    violation: 0.0006991377766200998
    violation: 0.0005706218431927248
    violation: 0.00046362862409557996
    violation: 0.0003748723547990095
    violation: 0.0003032579084427651
    violation: 0.00024636638593844015
    violation: 0.00019825804790411125
    violation: 0.00015827733519297
    violation: 0.00012439075792820058
    violation: 9.611089606618616e-05
    Converged at iteration 42




.. GENERATED FROM PYTHON SOURCE LINES 64-66

Plot results
------------

.. GENERATED FROM PYTHON SOURCE LINES 66-67

.. code-block:: Python

    C.T.plot(title="Concentration", colormap=None, legend=C.k.labels)



.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_002.png
   :alt: Concentration
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_002.png
   :class: sphx-glr-single-img



.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">

    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 69-75

.. code-block:: Python

    m = St.ptp()
    for i in range(St.shape[0]):
        St.data[i] -= i * m / 2
    ax = St.plot(title="Components", colormap=None, legend=St.k.labels)
    ax.set_yticks([])




.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_003.png
   :alt: Components
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_003.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    []



.. GENERATED FROM PYTHON SOURCE LINES 76-78

This ends the example ! The following line can be uncommented if no plot shows when
running the .py script with python

.. GENERATED FROM PYTHON SOURCE LINES 78-80

.. code-block:: Python


    # scp.show()








.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 1.184 seconds)


.. _sphx_glr_download_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_nmf.ipynb <plot_nmf.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_nmf.py <plot_nmf.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: plot_nmf.zip <plot_nmf.zip>`
