
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/plot_nmf.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py:


NMF analysis example
====================

.. GENERATED FROM PYTHON SOURCE LINES 15-16

Import the spectrochempy API package

.. GENERATED FROM PYTHON SOURCE LINES 16-18

.. code-block:: Python

    import spectrochempy as scp








.. GENERATED FROM PYTHON SOURCE LINES 19-21

Prepare the dataset to NMF factorize
-------------------------------------

.. GENERATED FROM PYTHON SOURCE LINES 23-25

Here we use a FTIR dataset corresponding the dehydration of a NH4Y zeolite
and recorded in the OMNIC format.

.. GENERATED FROM PYTHON SOURCE LINES 25-27

.. code-block:: Python

    dataset = scp.read_omnic("irdata/nh4y-activation.spg")








.. GENERATED FROM PYTHON SOURCE LINES 28-31

Mask some columns (features) wich correspond to saturated part of the spectra.
Note taht we use float number for defining the limits for masking as coordinates
(integer numbers would mean point index and s would lead t incorrect results)

.. GENERATED FROM PYTHON SOURCE LINES 31-33

.. code-block:: Python

    dataset[:, 882.0:1280.0] = scp.MASKED








.. GENERATED FROM PYTHON SOURCE LINES 34-37

Make sure all data are positive. For this we use the math fonctionalities of NDDataset
objects (:meth:`min` function to find the minimum value of the dataset
and the `-` operator for subtrating this value to all spectra of the dataset.

.. GENERATED FROM PYTHON SOURCE LINES 37-39

.. code-block:: Python

    dataset -= dataset.min()








.. GENERATED FROM PYTHON SOURCE LINES 40-41

Plot it for a visual check

.. GENERATED FROM PYTHON SOURCE LINES 41-42

.. code-block:: Python

    dataset.plot()



.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_001.png
   :alt: plot nmf
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_001.png
   :class: sphx-glr-single-img



.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">

    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 43-48

Create a NMF object
-------------------

As argument of the object constructor we define log_level to ``"INFO"`` to
obtain verbose output during fit, and we set the number of component to use at 4.

.. GENERATED FROM PYTHON SOURCE LINES 48-50

.. code-block:: Python

    model = scp.NMF(n_components=4, log_level="INFO")








.. GENERATED FROM PYTHON SOURCE LINES 51-53

Fit the model
-------------

.. GENERATED FROM PYTHON SOURCE LINES 53-63

.. code-block:: Python

    model.fit(dataset)
    # Get the results
    # ---------------
    #
    # The concentration :math:`C` and the transposed matrix of spectra :math:`S^T` can
    # be obtained as follow
    C = model.transform()
    St = model.components






.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    violation: 1.0
    violation: 0.14017421024502022
    violation: 0.06158195065493265
    violation: 0.034777744528725195
    violation: 0.023155912689776906
    violation: 0.01628956483660756
    violation: 0.011732197722809846
    violation: 0.009261179153190106
    violation: 0.00777050252991454
    violation: 0.00695747161015906
    violation: 0.006457414370355275
    violation: 0.006191115125282037
    violation: 0.006057238974457718
    violation: 0.00600077780633938
    violation: 0.005868357891308776
    violation: 0.005802918028534136
    violation: 0.00577236765883008
    violation: 0.0057569479717779325
    violation: 0.005733332889919094
    violation: 0.005700606624645048
    violation: 0.0056678270787910755
    violation: 0.005587736630048508
    violation: 0.005529135183166938
    violation: 0.0054607606740758
    violation: 0.00537519467345183
    violation: 0.0052880544420749005
    violation: 0.005203284939611608
    violation: 0.005110269931845272
    violation: 0.005004969613317592
    violation: 0.004889401944567172
    violation: 0.004778610916794773
    violation: 0.004657040705272774
    violation: 0.004527642308383105
    violation: 0.004393717477174938
    violation: 0.00426712413892581
    violation: 0.0041339281330162615
    violation: 0.00401275592813879
    violation: 0.0038914653519268472
    violation: 0.0037652602700427506
    violation: 0.0036375148218628526
    violation: 0.0035147101661544074
    violation: 0.003396513830358378
    violation: 0.003292520557980426
    violation: 0.0031941648132721035
    violation: 0.003104947029333343
    violation: 0.0030221674035499405
    violation: 0.0029389646390338164
    violation: 0.002856115850045587
    violation: 0.002773891218680294
    violation: 0.002692711668736965
    violation: 0.0026129548289077443
    violation: 0.0025351644702119596
    violation: 0.0024587403634384747
    violation: 0.0023842026907913197
    violation: 0.0023133039094785897
    violation: 0.002243736743481147
    violation: 0.0021751169925786334
    violation: 0.0021084094490923327
    violation: 0.002043667805247705
    violation: 0.0019806643593505056
    violation: 0.0019243270194360318
    violation: 0.001871326163205837
    violation: 0.0018195678200697127
    violation: 0.0017692749012868313
    violation: 0.0017204657491193404
    violation: 0.0016731692686996408
    violation: 0.0016274950351472658
    violation: 0.001583917332969941
    violation: 0.0015418960309269585
    violation: 0.0015014385431314668
    violation: 0.001462927201215864
    violation: 0.0014262081321619038
    violation: 0.001390759765809006
    violation: 0.0013601582805158091
    violation: 0.0013328464824005576
    violation: 0.0013065923988236769
    violation: 0.0012813357494809838
    violation: 0.0012569657401120874
    violation: 0.0012363658727399408
    violation: 0.0012190114699549435
    violation: 0.0011992116544500742
    violation: 0.0011775622624513853
    violation: 0.0011582609085414135
    violation: 0.0011389415923632501
    violation: 0.0011199124929362188
    violation: 0.001100675488453885
    violation: 0.0010832777040277308
    violation: 0.0010661363692303716
    violation: 0.0010491933694700864
    violation: 0.001031824410260506
    violation: 0.0010150792321235612
    violation: 0.0009988201809299714
    violation: 0.0009841318528818052
    violation: 0.0009699922960879194
    violation: 0.0009545966012008652
    violation: 0.0009396363331385406
    violation: 0.0009266599168143387
    violation: 0.0009140262172605387
    violation: 0.0009015875006376611
    violation: 0.0008902182357108452
    violation: 0.0008780499311870485
    violation: 0.0008660457470918695
    violation: 0.0008543517499944016
    violation: 0.0008428706003289022
    violation: 0.0008315536804371441
    violation: 0.0008208847158801008
    violation: 0.0008104269807763824
    violation: 0.0007997522484734256
    violation: 0.0007893350738955057
    violation: 0.0007791326607913869
    violation: 0.0007691414390016362
    violation: 0.0007597179067855231
    violation: 0.0007504652538893825
    violation: 0.0007412456856972063
    violation: 0.000732296617053989
    violation: 0.0007235915691681986
    violation: 0.000715192005539578
    violation: 0.0007069372346702958
    violation: 0.0006987637535247983
    violation: 0.000690773355082168
    violation: 0.000683029877979829
    violation: 0.0006754181243925205
    violation: 0.0006679795936490978
    violation: 0.0006606893398231194
    violation: 0.0006536091296352496
    violation: 0.000646664112099756
    violation: 0.0006399762615476357
    violation: 0.0006335488650773178
    violation: 0.0006273957420692118
    violation: 0.000621523600071377
    violation: 0.0006161518203754961
    violation: 0.000611391815177238
    violation: 0.0006071251736134113
    violation: 0.0006030938520872734
    violation: 0.0005992255771889233
    violation: 0.0005955122189368474
    violation: 0.0005919356405963877
    violation: 0.0005884735105285484
    violation: 0.0005851626197891285
    violation: 0.0005819472966806277
    violation: 0.0005788624242479742
    violation: 0.0005759087479595111
    violation: 0.0005730546137310565
    violation: 0.0005702968600981689
    violation: 0.0005676053787179165
    violation: 0.0005650176785171332
    violation: 0.0005624480584370688
    violation: 0.0005599281471045842
    violation: 0.0005574208102719345
    violation: 0.0005549930907511842
    violation: 0.0005526263090688467
    violation: 0.0005503237863510962
    violation: 0.0005480875748007252
    violation: 0.0005458976082894328
    violation: 0.0005437570853967795
    violation: 0.0005416726314724987
    violation: 0.0005396329582222046
    violation: 0.0005376381718605749
    violation: 0.0005358628850808565
    violation: 0.000534256644634498
    violation: 0.0005327134944358563
    violation: 0.000531170025618139
    violation: 0.0005296374901748815
    violation: 0.0005281469649346341
    violation: 0.0005266549474162208
    violation: 0.0005251860718893811
    violation: 0.000523731810759191
    violation: 0.0005222955570666714
    violation: 0.000520894296423796
    violation: 0.0005195265168842604
    violation: 0.000518181342811206
    violation: 0.0005168846752734863
    violation: 0.0005156608680273894
    violation: 0.0005144616554310419
    violation: 0.0005132891688192531
    violation: 0.0005121515266403868
    violation: 0.0005110364330889769
    violation: 0.0005099447315063968
    violation: 0.0005088753613791836
    violation: 0.0005078236610582794
    violation: 0.0005067909112023038
    violation: 0.0005057740763561833
    violation: 0.0005047767175611825
    violation: 0.0005037958933650074
    violation: 0.0005028222129279246
    violation: 0.0005018650428479665
    violation: 0.0005009224423801258
    violation: 0.0004999974962489743
    violation: 0.000499087239519854
    violation: 0.0004981962000751666
    violation: 0.0004973147318191464
    violation: 0.0004964417296739259
    violation: 0.0004955753197883387
    violation: 0.0004946901218457697
    violation: 0.0004938210437305386
    violation: 0.0004929673596844034
    violation: 0.000492122635584221
    violation: 0.0004912871202794875
    violation: 0.0004904596528539909
    violation: 0.0004896376456529141
    /home/runner/work/spectrochempy/spectrochempy/.venv/lib/python3.13/site-packages/sklearn/decomposition/_nmf.py:1728: ConvergenceWarning: Maximum number of iterations 200 reached. Increase it to improve convergence.
      warnings.warn(
    violation: 1.0
    violation: 0.27811881011284934
    violation: 0.21103839273441824
    violation: 0.16365897573754865
    violation: 0.12638124502857231
    violation: 0.09689398092857977
    violation: 0.07386553913526452
    violation: 0.057263048836391044
    violation: 0.046397106968950545
    violation: 0.03776270101072379
    violation: 0.030324671559647968
    violation: 0.024000077998569312
    violation: 0.018705054318855087
    violation: 0.014282427091627713
    violation: 0.01067612345146833
    violation: 0.008016534827385458
    violation: 0.006238616114827995
    violation: 0.005124394633029885
    violation: 0.004490757479656304
    violation: 0.0040531157511231675
    violation: 0.0037443026036686525
    violation: 0.003428962811660751
    violation: 0.003032319034755764
    violation: 0.002727253739146627
    violation: 0.002386505694046916
    violation: 0.0020851628627839413
    violation: 0.001769748469516069
    violation: 0.0014925716272856404
    violation: 0.0012488601974043909
    violation: 0.0010438675111376717
    violation: 0.0008573236692761335
    violation: 0.0006991377766200128
    violation: 0.0005706218431926706
    violation: 0.0004636286240955039
    violation: 0.00037487235479895443
    violation: 0.0003032579084426875
    violation: 0.00024636638593839727
    violation: 0.00019825804790409254
    violation: 0.00015827733519293714
    violation: 0.00012439075792815057
    violation: 9.6110896066177e-05
    Converged at iteration 42




.. GENERATED FROM PYTHON SOURCE LINES 64-66

Plot results
------------

.. GENERATED FROM PYTHON SOURCE LINES 66-67

.. code-block:: Python

    C.T.plot(title="Concentration", colormap=None, legend=C.k.labels)



.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_002.png
   :alt: Concentration
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_002.png
   :class: sphx-glr-single-img



.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">

    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 69-75

.. code-block:: Python

    m = St.ptp()
    for i in range(St.shape[0]):
        St.data[i] -= i * m / 2
    ax = St.plot(title="Components", colormap=None, legend=St.k.labels)
    ax.set_yticks([])




.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_003.png
   :alt: Components
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_003.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    []



.. GENERATED FROM PYTHON SOURCE LINES 76-78

This ends the example ! The following line can be uncommented if no plot shows when
running the .py script with python

.. GENERATED FROM PYTHON SOURCE LINES 78-80

.. code-block:: Python


    # scp.show()








.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 1.104 seconds)


.. _sphx_glr_download_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_nmf.ipynb <plot_nmf.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_nmf.py <plot_nmf.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: plot_nmf.zip <plot_nmf.zip>`
