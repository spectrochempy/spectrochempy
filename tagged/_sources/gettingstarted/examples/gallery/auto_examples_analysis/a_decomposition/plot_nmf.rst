
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/plot_nmf.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py:


NMF analysis example
====================

.. GENERATED FROM PYTHON SOURCE LINES 15-16

Import the spectrochempy API package

.. GENERATED FROM PYTHON SOURCE LINES 16-18

.. code-block:: Python

    import spectrochempy as scp








.. GENERATED FROM PYTHON SOURCE LINES 19-21

Prepare the dataset to NMF factorize
-------------------------------------

.. GENERATED FROM PYTHON SOURCE LINES 23-25

Here we use a FTIR dataset corresponding the dehydration of a NH4Y zeolite
and recorded in the OMNIC format.

.. GENERATED FROM PYTHON SOURCE LINES 25-27

.. code-block:: Python

    dataset = scp.read_omnic("irdata/nh4y-activation.spg")








.. GENERATED FROM PYTHON SOURCE LINES 28-31

Mask some columns (features) wich correspond to saturated part of the spectra.
Note taht we use float number for defining the limits for masking as coordinates
(integer numbers would mean point index and s would lead t incorrect results)

.. GENERATED FROM PYTHON SOURCE LINES 31-33

.. code-block:: Python

    dataset[:, 882.0:1280.0] = scp.MASKED








.. GENERATED FROM PYTHON SOURCE LINES 34-37

Make sure all data are positive. For this we use the math fonctionalities of NDDataset
objects (:meth:`min` function to find the minimum value of the dataset
and the `-` operator for subtrating this value to all spectra of the dataset.

.. GENERATED FROM PYTHON SOURCE LINES 37-39

.. code-block:: Python

    dataset -= dataset.min()








.. GENERATED FROM PYTHON SOURCE LINES 40-41

Plot it for a visual check

.. GENERATED FROM PYTHON SOURCE LINES 41-43

.. code-block:: Python

    _ = dataset.plot()




.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_001.png
   :alt: plot nmf
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_001.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 44-49

Create a NMF object
-------------------

As argument of the object constructor we define log_level to ``"INFO"`` to
obtain verbose output during fit, and we set the number of component to use at 4.

.. GENERATED FROM PYTHON SOURCE LINES 49-51

.. code-block:: Python

    model = scp.NMF(n_components=4, log_level="INFO")








.. GENERATED FROM PYTHON SOURCE LINES 52-54

Fit the model
-------------

.. GENERATED FROM PYTHON SOURCE LINES 54-65

.. code-block:: Python

    _ = model.fit(dataset)

    # Get the results
    # ---------------
    #
    # The concentration :math:`C` and the transposed matrix of spectra :math:`S^T` can
    # be obtained as follow
    C = model.transform()
    St = model.components






.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    violation: 1.0
    violation: 0.14017421024502064
    violation: 0.06158195065493269
    violation: 0.03477774452872524
    violation: 0.023155912689776983
    violation: 0.016289564836607325
    violation: 0.011732197722809702
    violation: 0.009261179153190077
    violation: 0.0077705025299143705
    violation: 0.006957471610159306
    violation: 0.0064574143703549965
    violation: 0.006191115125282162
    violation: 0.0060572389744578
    violation: 0.006000777806339381
    violation: 0.00586835789130887
    violation: 0.00580291802853402
    violation: 0.005772367658829965
    violation: 0.005756947971778068
    violation: 0.005733332889919035
    violation: 0.005700606624644948
    violation: 0.005667827078790933
    violation: 0.005587736630048323
    violation: 0.005529135183167127
    violation: 0.005460760674075951
    violation: 0.0053751946734517855
    violation: 0.0052880544420751165
    violation: 0.00520328493961151
    violation: 0.005110269931845416
    violation: 0.005004969613317401
    violation: 0.004889401944567163
    violation: 0.0047786109167946384
    violation: 0.004657040705272495
    violation: 0.004527642308383119
    violation: 0.0043937174771749585
    violation: 0.004267124138925793
    violation: 0.004133928133015981
    violation: 0.004012755928138604
    violation: 0.0038914653519267982
    violation: 0.003765260270042736
    violation: 0.0036375148218626414
    violation: 0.0035147101661542834
    violation: 0.0033965138303582404
    violation: 0.003292520557980553
    violation: 0.003194164813272309
    violation: 0.003104947029333527
    violation: 0.0030221674035498043
    violation: 0.0029389646390341052
    violation: 0.0028561158500455203
    violation: 0.0027738912186800807
    violation: 0.0026927116687368506
    violation: 0.002612954828907622
    violation: 0.002535164470212059
    violation: 0.002458740363438075
    violation: 0.002384202690790909
    violation: 0.002313303909478555
    violation: 0.0022437367434810095
    violation: 0.002175116992578672
    violation: 0.0021084094490922173
    violation: 0.0020436678052480795
    violation: 0.001980664359350659
    violation: 0.0019243270194359884
    violation: 0.001871326163205898
    violation: 0.0018195678200695691
    violation: 0.0017692749012867797
    violation: 0.0017204657491192705
    violation: 0.0016731692686995194
    violation: 0.0016274950351468248
    violation: 0.0015839173329698123
    violation: 0.001541896030927319
    violation: 0.0015014385431312133
    violation: 0.0014629272012159785
    violation: 0.0014262081321618617
    violation: 0.00139075976580911
    violation: 0.0013601582805157673
    violation: 0.0013328464824001918
    violation: 0.0013065923988232764
    violation: 0.0012813357494812598
    violation: 0.0012569657401119059
    violation: 0.001236365872739903
    violation: 0.0012190114699551333
    violation: 0.001199211654450196
    violation: 0.001177562262451393
    violation: 0.0011582609085414397
    violation: 0.0011389415923630179
    violation: 0.001119912492936129
    violation: 0.0011006754884539721
    violation: 0.0010832777040277759
    violation: 0.001066136369230753
    violation: 0.0010491933694701545
    violation: 0.001031824410260781
    violation: 0.001015079232123467
    violation: 0.0009988201809300774
    violation: 0.0009841318528817098
    violation: 0.0009699922960877186
    violation: 0.0009545966012006977
    violation: 0.0009396363331386859
    violation: 0.0009266599168144502
    violation: 0.0009140262172602579
    violation: 0.0009015875006376751
    violation: 0.0008902182357106479
    violation: 0.0008780499311870413
    violation: 0.0008660457470918699
    violation: 0.000854351749993845
    violation: 0.0008428706003287968
    violation: 0.0008315536804371594
    violation: 0.0008208847158802718
    violation: 0.0008104269807765611
    violation: 0.0007997522484738236
    violation: 0.0007893350738955173
    violation: 0.0007791326607915317
    violation: 0.0007691414390019042
    violation: 0.0007597179067853135
    violation: 0.0007504652538893616
    violation: 0.0007412456856969442
    violation: 0.0007322966170539948
    violation: 0.0007235915691686049
    violation: 0.0007151920055395387
    violation: 0.0007069372346699917
    violation: 0.0006987637535247382
    violation: 0.0006907733550827166
    violation: 0.0006830298779798798
    violation: 0.0006754181243926692
    violation: 0.0006679795936491825
    violation: 0.000660689339823285
    violation: 0.0006536091296355372
    violation: 0.0006466641120995258
    violation: 0.0006399762615474049
    violation: 0.0006335488650772826
    violation: 0.0006273957420689654
    violation: 0.0006215236000711757
    violation: 0.0006161518203756256
    violation: 0.0006113918151773189
    violation: 0.0006071251736134508
    violation: 0.0006030938520874124
    violation: 0.000599225577188736
    violation: 0.0005955122189367684
    violation: 0.0005919356405961484
    violation: 0.0005884735105283722
    violation: 0.0005851626197890011
    violation: 0.0005819472966806089
    violation: 0.0005788624242478594
    violation: 0.0005759087479600565
    violation: 0.0005730546137309978
    violation: 0.0005702968600982863
    violation: 0.000567605378718093
    violation: 0.0005650176785171586
    violation: 0.0005624480584370743
    violation: 0.0005599281471046596
    violation: 0.0005574208102720299
    violation: 0.0005549930907511363
    violation: 0.0005526263090688457
    violation: 0.0005503237863513085
    violation: 0.0005480875748007953
    violation: 0.0005458976082891286
    violation: 0.0005437570853969101
    violation: 0.0005416726314725979
    violation: 0.0005396329582221352
    violation: 0.0005376381718607317
    violation: 0.0005358628850811336
    violation: 0.0005342566446342794
    violation: 0.0005327134944357388
    violation: 0.0005311700256181299
    violation: 0.0005296374901748336
    violation: 0.0005281469649351055
    violation: 0.0005266549474162346
    violation: 0.0005251860718893411
    violation: 0.0005237318107589177
    violation: 0.0005222955570666999
    violation: 0.0005208942964235875
    violation: 0.0005195265168844998
    violation: 0.0005181813428111964
    violation: 0.0005168846752737034
    violation: 0.0005156608680271693
    violation: 0.0005144616554312984
    violation: 0.0005132891688193577
    violation: 0.0005121515266403545
    violation: 0.0005110364330891297
    violation: 0.0005099447315065913
    violation: 0.000508875361378858
    violation: 0.0005078236610584996
    violation: 0.0005067909112021698
    violation: 0.0005057740763560194
    violation: 0.0005047767175615129
    violation: 0.000503795893365037
    violation: 0.0005028222129274776
    violation: 0.0005018650428479086
    violation: 0.0005009224423800434
    violation: 0.0004999974962486426
    violation: 0.0004990872395196795
    violation: 0.0004981962000748055
    violation: 0.0004973147318190536
    violation: 0.0004964417296743154
    violation: 0.0004955753197882315
    violation: 0.0004946901218458283
    violation: 0.0004938210437307322
    violation: 0.0004929673596843698
    violation: 0.0004921226355845338
    violation: 0.0004912871202793567
    violation: 0.0004904596528542114
    violation: 0.0004896376456529366
    /home/runner/micromamba/envs/scpy_docs/lib/python3.12/site-packages/sklearn/decomposition/_nmf.py:1742: ConvergenceWarning: Maximum number of iterations 200 reached. Increase it to improve convergence.
      warnings.warn(
    violation: 1.0
    violation: 0.27811881011284817
    violation: 0.2110383927344171
    violation: 0.16365897573754795
    violation: 0.12638124502857215
    violation: 0.09689398092857987
    violation: 0.07386553913526465
    violation: 0.0572630488363914
    violation: 0.046397106968950975
    violation: 0.0377627010107243
    violation: 0.030324671559648467
    violation: 0.024000077998569787
    violation: 0.01870505431885559
    violation: 0.014282427091628174
    violation: 0.010676123451468641
    violation: 0.008016534827385702
    violation: 0.006238616114828256
    violation: 0.005124394633030057
    violation: 0.0044907574796564514
    violation: 0.004053115751123256
    violation: 0.00374430260366872
    violation: 0.003428962811660757
    violation: 0.003032319034755823
    violation: 0.0027272537391466937
    violation: 0.0023865056940469637
    violation: 0.002085162862784038
    violation: 0.0017697484695161614
    violation: 0.0014925716272857186
    violation: 0.0012488601974044676
    violation: 0.001043867511137741
    violation: 0.0008573236692761593
    violation: 0.0006991377766200215
    violation: 0.0005706218431927061
    violation: 0.00046362862409556424
    violation: 0.00037487235479899866
    violation: 0.0003032579084427101
    violation: 0.00024636638593841743
    violation: 0.00019825804790407907
    violation: 0.00015827733519297973
    violation: 0.00012439075792817795
    violation: 9.61108960661693e-05
    Converged at iteration 42




.. GENERATED FROM PYTHON SOURCE LINES 66-68

Plot results
------------

.. GENERATED FROM PYTHON SOURCE LINES 68-70

.. code-block:: Python

    _ = C.T.plot(title="Concentration", colormap=None, legend=C.k.labels)




.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_002.png
   :alt: Concentration
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_002.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 72-78

.. code-block:: Python

    m = St.ptp()
    for i in range(St.shape[0]):
        St.data[i] -= i * m / 2
    ax = St.plot(title="Components", colormap=None, legend=St.k.labels)
    ax.set_yticks([])




.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_003.png
   :alt: Components
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_003.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    []



.. GENERATED FROM PYTHON SOURCE LINES 79-81

This ends the example ! The following line can be uncommented if no plot shows when
running the .py script with python

.. GENERATED FROM PYTHON SOURCE LINES 81-83

.. code-block:: Python


    # scp.show()








.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 0.916 seconds)


.. _sphx_glr_download_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_nmf.ipynb <plot_nmf.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_nmf.py <plot_nmf.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: plot_nmf.zip <plot_nmf.zip>`
